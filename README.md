perl-out-of-order
=================

Sample code for my YAPC::NA talk "Perl Out Of Order"

The application presented is a simple Mojo::Lite app that generates a report. This report is generated by combining data from 2 HTTP requests with a long running SQL query. The goal of this project is to show how to make small architectural improvements to web applications, including how to identify and troubleshoot specific bottlenecks.

## Setup Instructions
### Database
This project was initially set up using Postgres. You can also use a different Database Server.

#### Instructions for setup with Postgres
This assumes you already have Postgres installed and configured.

1. Create a new user called poo and set the password to "pooiscool": `sudo -u postgres createuser -D -A -P poo`
1. Create a new database called poo for the poo user you just created: `sudo -u postgres createdb -O poo poo`
1. Create a new file called .pgpass in your home directory, or append the following line to it: `localhost:5432:poo:poo:password`
1. You may need to edit connection permissions if there are any client connectivity issues: 
  1. Edit `/etc/postgresql/9.1/main/pg_hba.conf` Change "peer" to "md5" on the line for "local" 
  1. Restart PostgreSQL - `sudo /etc/init.d/postgresql restart`
1. Load the schema in the 'sql' directory: `psql -U poo -d poo -a -f 01_poo.sql`

You now have a database called "poo" with the schema, data, and some initial reports inserted. One thing to note, the images table is created as an empty table. The images I used in my talk were courtesy of Shutterstock and I cannot redistribute them. Feel free to find 50 of your own images and load them into that table as binary data. I've added the script I used to load the images in the support directory.

The test data is provided from the samples on the PG Foundry website: http://pgfoundry.org/projects/dbsamples/ I modified the first names so they would have real names instead of encoded ones, just for demonstration purposes (I thought it might look nicer).

#### Using a different Database Server
If you don't want to use Postgres, you can change the "dsn" string (just grep the repo). Follow the setup instructions for Postgres but adapt it for your database server of choice as appropriate. Normally I use a config file to load this seperately but for this demo, a hard-coded dsn string was acceptable.

### Rabbitmq
I installed rabbitmq-server through apt-get. I also recommend enabling the RabbitMQ administration plugin that lets you manage RMQ through a web browser.

The application just uses the default guest/guest configuration.

## Running the Applications
TODO
